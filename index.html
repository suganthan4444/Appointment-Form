<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Appointment</title>
    <link rel="stylesheet" href="index.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-doughnutlabel@2.0.3"></script>
    <script src="index.js"></script>
  </head>
  <body>
    <form id="myForm" onsubmit="submit_form(event)" novalidate>
      <div class="input-fields">
        <span id="title">Appointment Form</span>
        <div class="form-row">
          <div class="appointment-form">
            <select
              id="title-options"
              oninput="validateTitle()"
              autocomplete="off"
              required
            >
              <option value="" disabled selected hidden></option>
              <option value="Mr.">Mr</option>
              <option value="Ms.">Ms</option>
              <option value="Mrs.">Mrs</option>
            </select>
            <label for="title-options">Title</label>
            <div class="error-message" id="titleError"></div>
          </div>

          <div class="appointment-form">
            <input
              type="text"
              id="first-name"
              oninput="validateFirstName()"
              onchange="validateFirstName()"
              onblur="checkFirstName()"
              placeholder=" "
              autocomplete="off"
              required
            />
            <label for="first-name">First Name</label>
            <div class="error-message" id="firstNameError"></div>
          </div>

          <div class="appointment-form">
            <input
              type="text"
              id="last-name"
              oninput="validateLastName()"
              onchange="validateLastName()"
              placeholder=" "
              autocomplete="fake"
              required
            />
            <label for="last-name">Last Name</label>
            <div class="error-message" id="lastNameError"></div>
          </div>

          <div id="appointment-form">
            <div id="phone-wrapper">
              <div id="phone-group">
                <select id="country-code" required>
                  <option value="" hidden selected hidden></option>
                  <option value="+91">ðŸ‡®ðŸ‡³ +91</option>
                  <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
                  <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
                  <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
                </select>
                <input
                  type="tel"
                  id="mobile-number"
                  placeholder=" "
                  inputmode="numeric"
                  oninput="validateMobile()"
                  onchange="validateMobile()"
                  onblur="validateMobileLength()"
                  autocomplete="fake"
                  required
                />
                <label for="mobile-number">Mobile Number</label>
              </div>
              <div class="error-message" id="mobileError"></div>
            </div>
          </div>

          <div class="appointment-form">
            <input
              type="email"
              id="email"
              oninput="validateEmail()"
              onblur="validateEmailChange()"
              placeholder=" "
              autocomplete="fake"
              required
            />
            <label for="email">Email</label>
            <div class="error-message" id="emailError"></div>
          </div>

          <div class="appointment-form">
            <input
              type="text"
              id="date-of-birth"
              oninput="validateDOB()"
              onfocus="this.type='date'"
              onblur="if(!this.value) this.type='text'"
              placeholder=""
              required
            />
            <label for="date-of-birth">Date of Birth</label>
            <div class="error-message" id="dobError"></div>
          </div>
        </div>

        <div class="loan-row">
          <div class="appointment-form">
            <input
              type="text"
              id="amount"
              placeholder=" "
              oninput="validateAmount()"
              onblur="validateAmountChange()"
              autocomplete="fake"
              required
            />
            <label for="amount" id="amountLabel">Loan Amount</label>
            <div class="error-message" id="amountError"></div>
          </div>

          <div class="appointment-form">
            <div class="range-wrapper">
              <span class="range-label">50K</span>
              <input
                type="range"
                id="amount_range"
                class="range-input"
                min="50000"
                max="5000000"
                step="1000"
                value="50000"
                style="margin: 0 10px; flex: 1"
              />
              <span class="range-label">50L</span>
            </div>
          </div>
          <div class="appointment-form">
            <input
              type="number"
              id="interest"
              placeholder=" "
              min="9.9"
              max="22"
              step="0.1"
              onfocus="if(!this.value) this.value='9.9'"
              oninput="validateInterest()"
              onchange="validateInterestChange()"
              autocomplete="fake"
              required
            />
            <label for="interest" id="interestLabel">Interest</label>
            <div class="error-message" id="interestError"></div>
          </div>

          <div class="appointment-form">
            <div class="range-wrapper">
              <span class="range-label">9.9%</span>
              <input
                type="range"
                id="interest_range"
                class="range-input"
                min="9.9"
                max="22"
                step="0.1"
                value="9.9"
                style="margin: 0 10px; flex: 1"
              />
              <span class="range-label">22%</span>
            </div>
          </div>
          <div class="appointment-form">
            <input
              type="number"
              id="period"
              placeholder=" "
              oninput="validatePeriod()"
              onblur="validatePeriodChange()"
              autocomplete="fake"
              required
            />
            <label for="period" id="periodLabel">Period</label>
            <div class="error-message" id="periodError"></div>
          </div>

          <div class="appointment-form">
            <div class="range-wrapper">
              <span class="range-label">12</span>
              <input
                type="range"
                id="period_range"
                class="range-input"
                min="12"
                max="84"
                step="1"
                value="12"
                style="margin: 0 10px; flex: 1"
              />
              <span class="range-label">84</span>
            </div>
          </div>
        </div>
      </div>
      <div class="result-row">
        <table class="result-table">
          <tbody>
            <tr>
              <th>Loan Amount</th>
              <td><input type="text" id="loan-amount" value="" disabled /></td>
            </tr>
            <tr>
              <th>Loan Interest</th>
              <td>
                <input type="text" id="loan-interest" value="" disabled />
              </td>
            </tr>
            <tr>
              <th>Amount Payable</th>
              <td><input type="text" id="total-amount" value="" disabled /></td>
            </tr>
            <tr>
              <th>EMI</th>
              <td><input type="text" id="emi" value="" disabled /></td>
            </tr>
          </tbody>
        </table>

        <div class="result-chart">
          <canvas id="loanGauge"></canvas>
        </div>
      </div>
      <div id="button">
        <button id="submit" type="submit">Submit</button>
      </div>
    </form>

    <script>
      const amount = document.getElementById("amount");
      const amountRange = document.getElementById("amount_range");
      const interest = document.getElementById("interest");
      const interestRange = document.getElementById("interest_range");
      const period = document.getElementById("period");
      const periodRange = document.getElementById("period_range");
      const countryCode = document.getElementById("country-code");
      const mobile = document.getElementById("mobile-number");
      const phoneGroup = document.getElementById("phone-group");
      const datePicker = document.getElementById("date-of-birth");

      window.addEventListener("load", () => {
        updateChart(0, 0);
      });

      amountRange.addEventListener("input", () => {
        amount.value = amountRange.value;
        validateAmount();
        calculateResult();
      });

      interestRange.addEventListener("input", () => {
        interest.value = interestRange.value;
        validateInterest();
        calculateResult();
      });

      periodRange.addEventListener("input", () => {
        period.value = periodRange.value;
        validatePeriod();
        calculateResult();
      });

      countryCode.addEventListener("focus", () => {
        countryCode.value = "+91";
      });

      countryCode.addEventListener("blur", () => {
        if (!mobile.value && countryCode.value == "+91") {
          countryCode.value = "";
        }
      });

      mobile.addEventListener("focus", () => {
        if (countryCode.value == "+91") {
          countryCode.value = "+91";
        } else if (countryCode.value == "") {
          countryCode.value = "+91";
        } else {
          countryCode.value = countryCode.value;
        }
      });

      mobile.addEventListener("blur", () => {
        if (!mobile.value && countryCode.value == "+91") {
          countryCode.value = "";
        }
      });

      mobile.addEventListener("keydown", function (e) {
        const controlKeys = [
          "Backspace",
          "Delete",
          "ArrowLeft",
          "ArrowRight",
          "Tab",
          "Enter",
        ];

        if (
          !controlKeys.includes(e.key) &&
          this.value.length >= 10 &&
          /^\d$/.test(e.key)
        ) {
          e.preventDefault();
        }
      });

      datePicker.addEventListener("focus", function () {
        this.showPicker?.();
      });
    </script>
  </body>
</html>
